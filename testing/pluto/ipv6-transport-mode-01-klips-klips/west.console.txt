/testing/guestbin/swan-prep --46
west #
 # confirm that the network is alive
west #
 ping6 -n -c 4 -I 2001:db8:1:2::45 2001:db8:1:2::23
PING 2001:db8:1:2::23(2001:db8:1:2::23) from 2001:db8:1:2::45 : 56 data bytes
64 bytes from 2001:db8:1:2::23: icmp_seq=1 ttl=64 time=0.XXX ms
64 bytes from 2001:db8:1:2::23: icmp_seq=2 ttl=64 time=0.XXX ms
64 bytes from 2001:db8:1:2::23: icmp_seq=3 ttl=64 time=0.XXX ms
64 bytes from 2001:db8:1:2::23: icmp_seq=4 ttl=64 time=0.XXX ms
--- 2001:db8:1:2::23 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time XXXX
rtt min/avg/max/mdev = 0.XXX/0.XXX/0.XXX/0.XXX ms
west #
 # ensure that clear text does not get through
west #
 ip6tables -A INPUT -i eth1 -s 2001:db8:1:2::23 -p ipv6-icmp --icmpv6-type echo-reply -j DROP
west #
 # confirm with a ping
west #
 ping6 -n -c 4 -I 2001:db8:1:2::45 2001:db8:1:2::23
PING 2001:db8:1:2::23(2001:db8:1:2::23) from 2001:db8:1:2::45 : 56 data bytes
--- 2001:db8:1:2::23 ping statistics ---
4 packets transmitted, 0 received, 100% packet loss, time XXXX
west #
 ipsec start
[ 00.00] registered KLIPS /proc/sys/net
[ 00.00] ipsec_3des_init(alg_type=15 alg_id=3 name=3des): ret=0
[ 00.00] KLIPS cryptoapi interface: alg_type=15 alg_id=12 name=cbc(aes) keyminbits=128 keymaxbits=256, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=15 alg_id=253 name=cbc(twofish) keyminbits=128 keymaxbits=256, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=15 alg_id=252 name=cbc(serpent) keyminbits=128 keymaxbits=256, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=15 alg_id=6 name=cbc(cast5) keyminbits=128 keymaxbits=128, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=15 alg_id=3 name=cbc(des3_ede) keyminbits=192 keymaxbits=192, found(0)
[ 00.00] KLIPS: lookup for ciphername=cipher_null: not found
[ 00.00] KLIPS cryptoapi interface: alg_type=14 alg_id=2 name=hmac(md5) ctx_size=88 keyminbits=128 keymaxbits=128, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=14 alg_id=3 name=hmac(sha1) ctx_size=88 keyminbits=160 keymaxbits=160, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=14 alg_id=5 name=hmac(sha256) ctx_size=88 keyminbits=256 keymaxbits=256, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=14 alg_id=6 name=hmac(sha384) ctx_size=88 keyminbits=384 keymaxbits=384, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=14 alg_id=7 name=hmac(sha512) ctx_size=88 keyminbits=512 keymaxbits=512, found(0)
[ 00.00] KLIPS cryptoapi interface: alg_type=14 alg_id=252 name=hmac(sha256) ctx_size=88 keyminbits=256 keymaxbits=256, found(0)
[ 00.00] 
Redirecting to: systemctl start ipsec.service
[ 00.00] 
west #
 /testing/pluto/bin/wait-until-pluto-started
west #
 ipsec auto --add v6-transport
002 added connection description "v6-transport"
west #
 ipsec auto --status
000 using kernel interface: klips
000 interface ipsec0/eth1 2001:db8:1:2::45@500
000 interface ipsec0/eth1 192.1.2.45@4500
000 interface ipsec0/eth1 192.1.2.45@500
000  
000  
000 fips mode=disabled;
000 SElinux=XXXXX
000 seccomp=OFF
000  
000 config setup options:
000  
000 configdir=/etc, configfile=/etc/ipsec.conf, secrets=/etc/ipsec.secrets, ipsecdir=/etc/ipsec.d
000 nssdir=/etc/ipsec.d, dumpdir=/tmp, statsbin=unset
000 dnssec-rootkey-file=/var/lib/unbound/root.key, dnssec-trusted=<unset>
000 sbindir=PATH/sbin, libexecdir=PATH/libexec/ipsec
000 nhelpers=-1, uniqueids=yes, dnssec-enable=yes, perpeerlog=no, logappend=no, logip=yes, shuntlifetime=900s, xfrmlifetime=300s
000 ddos-cookies-threshold=50000, ddos-max-halfopen=25000, ddos-mode=auto
000 ikeport=500, ikebuf=0, msg_errqueue=yes, strictcrlpolicy=no, crlcheckinterval=0, listen=<any>, nflog-all=0
000 ocsp-enable=no, ocsp-strict=no, ocsp-timeout=2, ocsp-uri=<unset>
000 ocsp-trust-name=<unset>
000 ocsp-cache-size=1000, ocsp-cache-min-age=3600, ocsp-cache-max-age=86400, ocsp-method=get
000 secctx-attr-type=XXXX
000 debug ...
000  
000 nat-traversal=yes, keep-alive=20, nat-ikeport=4500
000 virtual-private (%priv):
000  
000 ESP algorithms supported:
000  
000 algorithm ESP encrypt: id=3, name=ESP_3DES, ivlen=64, keysizemin=192, keysizemax=192
000 algorithm ESP encrypt: id=6, name=ESP_CAST, ivlen=64, keysizemin=128, keysizemax=128
000 algorithm ESP encrypt: id=12, name=ESP_AES, ivlen=128, keysizemin=128, keysizemax=256
000 algorithm ESP encrypt: id=252, name=ESP_SERPENT, ivlen=128, keysizemin=128, keysizemax=256
000 algorithm ESP encrypt: id=253, name=ESP_TWOFISH, ivlen=128, keysizemin=128, keysizemax=256
000 algorithm AH/ESP auth: id=1, name=AUTH_ALGORITHM_HMAC_MD5, keysizemin=128, keysizemax=128
000 algorithm AH/ESP auth: id=2, name=AUTH_ALGORITHM_HMAC_SHA1, keysizemin=160, keysizemax=160
000 algorithm AH/ESP auth: id=5, name=AUTH_ALGORITHM_HMAC_SHA2_256, keysizemin=256, keysizemax=256
000 algorithm AH/ESP auth: id=6, name=AUTH_ALGORITHM_HMAC_SHA2_384, keysizemin=384, keysizemax=384
000 algorithm AH/ESP auth: id=7, name=AUTH_ALGORITHM_HMAC_SHA2_512, keysizemin=512, keysizemax=512
000 algorithm AH/ESP auth: id=9, name=AUTH_ALGORITHM_AES_XCBC, keysizemin=128, keysizemax=128
000 algorithm AH/ESP auth: id=252, name=(null), keysizemin=256, keysizemax=256
000  
000 IKE algorithms supported:
000  
000 algorithm IKE encrypt: v1id=5, v1name=OAKLEY_3DES_CBC, v2id=3, v2name=3DES, blocksize=8, keydeflen=192
000 algorithm IKE encrypt: v1id=8, v1name=OAKLEY_CAMELLIA_CBC, v2id=23, v2name=CAMELLIA_CBC, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=-1, v1name=n/a, v2id=20, v2name=AES_GCM_C, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=-1, v1name=n/a, v2id=19, v2name=AES_GCM_B, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=-1, v1name=n/a, v2id=18, v2name=AES_GCM_A, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=13, v1name=OAKLEY_AES_CTR, v2id=13, v2name=AES_CTR, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=7, v1name=OAKLEY_AES_CBC, v2id=12, v2name=AES_CBC, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=65004, v1name=OAKLEY_SERPENT_CBC, v2id=65004, v2name=SERPENT_CBC, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=65005, v1name=OAKLEY_TWOFISH_CBC, v2id=65005, v2name=TWOFISH_CBC, blocksize=16, keydeflen=128
000 algorithm IKE encrypt: v1id=65289, v1name=OAKLEY_TWOFISH_CBC_SSH, v2id=65289, v2name=TWOFISH_CBC_SSH, blocksize=16, keydeflen=128
000 algorithm IKE PRF: name=HMAC_MD5, hashlen=16
000 algorithm IKE PRF: name=HMAC_SHA1, hashlen=20
000 algorithm IKE PRF: name=HMAC_SHA2_256, hashlen=32
000 algorithm IKE PRF: name=HMAC_SHA2_384, hashlen=48
000 algorithm IKE PRF: name=HMAC_SHA2_512, hashlen=64
000 algorithm IKE PRF: name=AES_XCBC, hashlen=16
000 algorithm IKE DH Key Exchange: name=MODP1024, bits=1024
000 algorithm IKE DH Key Exchange: name=MODP1536, bits=1536
000 algorithm IKE DH Key Exchange: name=MODP2048, bits=2048
000 algorithm IKE DH Key Exchange: name=MODP3072, bits=3072
000 algorithm IKE DH Key Exchange: name=MODP4096, bits=4096
000 algorithm IKE DH Key Exchange: name=MODP6144, bits=6144
000 algorithm IKE DH Key Exchange: name=MODP8192, bits=8192
000 algorithm IKE DH Key Exchange: name=DH19, bits=512
000 algorithm IKE DH Key Exchange: name=DH20, bits=768
000 algorithm IKE DH Key Exchange: name=DH21, bits=1056
000 algorithm IKE DH Key Exchange: name=DH23, bits=2048
000 algorithm IKE DH Key Exchange: name=DH24, bits=2048
000  
000 stats db_ops: {curr_cnt, total_cnt, maxsz} :context={0,0,0} trans={0,0,0} attrs={0,0,0} 
000  
000 Connection list:
000  
000 "v6-transport": 2001:db8:1:2::45<2001:db8:1:2::45>[@west]...2001:db8:1:2::23<2001:db8:1:2::23>[@east]; unrouted; eroute owner: #0
000 "v6-transport":     oriented; my_ip=unset; their_ip=unset; my_updown=ipsec _updown;
000 "v6-transport":   xauth us:none, xauth them:none,  my_username=[any]; their_username=[any]
000 "v6-transport":   our auth:rsasig, their auth:rsasig
000 "v6-transport":   modecfg info: us:none, them:none, modecfg policy:push, dns:unset, domains:unset, banner:unset, cat:unset;
000 "v6-transport":   labeled_ipsec:no;
000 "v6-transport":   policy_label:unset;
000 "v6-transport":   ike_life: 3600s; ipsec_life: 28800s; replay_window: 32; rekey_margin: 540s; rekey_fuzz: 100%; keyingtries: 0;
000 "v6-transport":   retransmit-interval: 9999ms; retransmit-timeout: 99s;
000 "v6-transport":   initial-contact:no; cisco-unity:no; fake-strongswan:no; send-vendorid:no; send-no-esp-tfc:no;
000 "v6-transport":   policy: RSASIG+ENCRYPT+PFS+IKEV1_ALLOW+IKEV2_ALLOW+SAREF_TRACK+IKE_FRAG_ALLOW+ESN_NO;
000 "v6-transport":   conn_prio: 128,128; interface: eth1; metric: 0; mtu: unset; sa_prio:auto; sa_tfc:none;
000 "v6-transport":   nflog-group: unset; mark: unset; vti-iface:unset; vti-routing:no; vti-shared:no; nic-offload:auto;
000 "v6-transport":   newest ISAKMP SA: #0; newest IPsec SA: #0;
000  
000 Total IPsec connections: loaded 1, active 0
000  
000 State Information: DDoS cookies not required, Accepting new IKE connections
000 IKE SAs: total(0), half-open(0), open(0), authenticated(0), anonymous(0)
000 IPsec SAs: total(0), authenticated(0), anonymous(0)
000  
000 Bare Shunt list:
000  
west #
 echo "initdone"
initdone
west #
 ipsec auto --up  v6-transport
002 "v6-transport" #1: initiating Main Mode
104 "v6-transport" #1: STATE_MAIN_I1: initiate
106 "v6-transport" #1: STATE_MAIN_I2: sent MI2, expecting MR2
108 "v6-transport" #1: STATE_MAIN_I3: sent MI3, expecting MR3
002 "v6-transport" #1: Peer ID is ID_FQDN: '@east'
004 "v6-transport" #1: STATE_MAIN_I4: ISAKMP SA established {auth=RSA_SIG cipher=aes_256 integ=sha group=MODP2048}
002 "v6-transport" #2: initiating Quick Mode RSASIG+ENCRYPT+PFS+UP+IKEV1_ALLOW+IKEV2_ALLOW+SAREF_TRACK+IKE_FRAG_ALLOW+ESN_NO
117 "v6-transport" #2: STATE_QUICK_I1: initiate
004 "v6-transport" #2: STATE_QUICK_I2: sent QI2, IPsec SA established transport mode {ESP=>0xESPESP <0xESPESP xfrm=AES_CBC_128-HMAC_SHA1_96 NATOA=none NATD=none DPD=passive}
west #
 ping6 -n -c 4 -I 2001:db8:1:2::45 2001:db8:1:2::23
PING 2001:db8:1:2::23(2001:db8:1:2::23) from 2001:db8:1:2::45 : 56 data bytes
64 bytes from 2001:db8:1:2::23: icmp_seq=1 ttl=64 time=0.XXX ms
64 bytes from 2001:db8:1:2::23: icmp_seq=2 ttl=64 time=0.XXX ms
64 bytes from 2001:db8:1:2::23: icmp_seq=3 ttl=64 time=0.XXX ms
64 bytes from 2001:db8:1:2::23: icmp_seq=4 ttl=64 time=0.XXX ms
--- 2001:db8:1:2::23 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time XXXX

west #
 ../../pluto/bin/ipsec-look.sh
west NOW
2001:db8:1:2::45/128 -> 2001:db8:1:2::23/128 => esp0x43952d72@2001:db8:1:2::23  (8)
ipsec0->eth1 mtu=16260(9999)->1500
ROUTING TABLES
default via 192.1.2.254 dev eth1 
169.254.0.0/16 dev eth0  scope link  metric 1002 
169.254.0.0/16 dev eth1  scope link  metric 1003 
169.254.0.0/16 dev eth2  scope link  metric 1004 
192.0.1.0/24 dev eth0 proto kernel scope link src 192.0.1.254 
192.0.2.0/24 via 192.1.2.23 dev eth1 
192.1.2.0/24 dev eth1 proto kernel scope link src 192.1.2.45 
192.9.4.0/24 dev eth2 proto kernel scope link src 192.9.4.45 
unreachable ::/96 dev lo  metric 1024  error -XXXX
unreachable ::ffff:0.0.0.0/96 dev lo  metric 1024  error -XXXX
2001:db8:0:1::/64 dev eth0  proto kernel  metric 256 
2001:db8::/48 via 2001:db8:1:2::23 dev eth1  metric 1024 
2001:db8:1:2::23 dev ipsec0  metric 0 
    cache 
2001:db8:1:2::23 dev ipsec0  metric 1024 
2001:db8:1:2::45 dev ipsec0  proto kernel  metric 256 
2001:db8:1:2::/64 dev eth1  proto kernel  metric 256 
2001:db8:9:4::/64 dev eth2  proto kernel  metric 256 
unreachable 2002:a00::/24 dev lo  metric 1024  error -XXXX
unreachable 2002:7f00::/24 dev lo  metric 1024  error -XXXX
unreachable 2002:a9fe::/32 dev lo  metric 1024  error -XXXX
unreachable 2002:ac10::/28 dev lo  metric 1024  error -XXXX
unreachable 2002:c0a8::/32 dev lo  metric 1024  error -XXXX
unreachable 2002:e000::/19 dev lo  metric 1024  error -XXXX
unreachable 3ffe:ffff::/32 dev lo  metric 1024  error -XXXX
fe80::1000:ff:fe64:6445 dev ipsec0  proto kernel  metric 256 
fe80::/64 dev eth0  proto kernel  metric 256 
fe80::/64 dev eth1  proto kernel  metric 256 
fe80::/64 dev eth2  proto kernel  metric 256 
default via 2001:db8:1:2::254 dev eth1  metric 1 
default via 2001:db8:1:2::254 dev eth1  metric 1024 
NSS_CERTIFICATES
Certificate Nickname                                         Trust Attributes
                                                             SSL,S/MIME,JAR/XPI
west #
 echo done
done
west #
 ../../pluto/bin/ipsec-look.sh
west NOW
2001:db8:1:2::45/128 -> 2001:db8:1:2::23/128 => esp0xESPSPI@2001:db8:1:2::23
ipsec0->eth1 mtu=16260(9999)->1500


ROUTING TABLES
default via 192.1.2.254 dev eth1 
192.0.1.0/24 dev eth0 proto kernel scope link src 192.0.1.254 
192.0.2.0/24 via 192.1.2.23 dev eth1 
192.1.2.0/24 dev eth1 proto kernel scope link src 192.1.2.45 
192.9.4.0/24 dev eth2 proto kernel scope link src 192.9.4.45 
unreachable ::/96 dev lo  metric 1024  error -XXXX
unreachable ::ffff:0.0.0.0/96 dev lo  metric 1024  error -XXXX
2001:db8:0:1::/64 dev eth0  proto kernel  metric 256 
2001:db8::/48 via 2001:db8:1:2::23 dev eth1  metric 1024 
2001:db8:1:2::23 dev ipsec0  metric 0 
    cache 
2001:db8:1:2::23 dev ipsec0  metric 1024 
2001:db8:1:2::45 dev ipsec0  proto kernel  metric 256 
2001:db8:1:2::/64 dev eth1  proto kernel  metric 256 
2001:db8:9:4::/64 dev eth2  proto kernel  metric 256 
unreachable 2002:a00::/24 dev lo  metric 1024  error -XXXX
unreachable 2002:7f00::/24 dev lo  metric 1024  error -XXXX
unreachable 2002:a9fe::/32 dev lo  metric 1024  error -XXXX
unreachable 2002:ac10::/28 dev lo  metric 1024  error -XXXX
unreachable 2002:c0a8::/32 dev lo  metric 1024  error -XXXX
unreachable 2002:e000::/19 dev lo  metric 1024  error -XXXX
unreachable 3ffe:ffff::/32 dev lo  metric 1024  error -XXXX
fe80::1000:ff:fe64:6445 dev ipsec0  proto kernel  metric 256 
fe80::/64 dev eth0  proto kernel  metric 256 
fe80::/64 dev eth1  proto kernel  metric 256 
fe80::/64 dev eth2  proto kernel  metric 256 
default via 2001:db8:1:2::254 dev eth1  metric 1 
default via 2001:db8:1:2::254 dev eth1  metric 1024 
NSS_CERTIFICATES
Certificate Nickname                                         Trust Attributes
                                                             SSL,S/MIME,JAR/XPI
west #
west #
 ../bin/check-for-core.sh
west #
 if [ -f /sbin/ausearch ]; then ausearch -r -m avc -ts recent ; fi

