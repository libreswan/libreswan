#!/bin/sh

uname=$(uname)

debug()
{
    : # echo "$@" > /dev/console
}

case ${uname} in
    *BSD)
	macs=$(ifconfig | grep -o -E '([[:xdigit:]]{1,2}:){5}[[:xdigit:]]{1,2}')
	;;
    *)
	macs=$(ip addr show | awk '/link.ether/ { print $2}')
	;;
esac
debug macs=$macs > /dev/console

for mac in ${macs} ; do
    case "$mac" in
	12:00:00:64:64:23 ) hostname=east ; break ;;
	12:00:00:64:64:45 ) hostname=west ; break ;;
	12:00:00:96:96:49 ) hostname=north ; break ;;
	12:00:00:ab:cd:02 ) hostname=road ; break ;;
	12:52:49:53:45:01 ) hostname=rise ; break ;;
	12:00:53:45:54:01 ) hostname=set ; break ;;
    esac
done
test "${hostname}" || hostname=$(echo ${uname} | tr '[A-Z]' '[a-z]]')
debug hostname=${hostname}

# interfaces
case ${hostname} in
    east)
     	ipv4_eth0=192.0.2.254/24
	ipv6_eth0=2001:db8:0:2::254/64
        ipv4_eth1=192.1.2.23/24
	ipv6_eth1=2001:db8:1:2::23/64
	dhcp_ethN=2
	ipv4_gw=192.1.2.254
	ipv6_gw=2001:db8:1:2::254
	;;
    west)
	ipv4_eth0=192.0.1.254/24
	ipv6_eth0=2001:db8:0:1::254/64
	ipv4_eth1=192.1.2.45/24
	ipv6_eth1=2001:db8:1:2::45/64
	dhcp_ethN=2
	ipv4_gw=192.1.2.254
	ipv6_gw=2001:db8:1:2::254
	;;
    north)
	ipv4_eth0=192.0.3.254/24
	ipv6_eth0=2001:db8:0:3::254/64
	ipv4_eth1=192.1.3.33/24
	ipv6_eth1=2001:db8:1.3::33/64
	dhcp_ethN=2
	ipv4_gw=192.1.3.254
	ipv6_gw=2001:db8:1.3::254
	;;
    road)
	ipv4_eth0=192.1.3.209/24
	ipv6_eth0=2001:db8:1.3::209/64
	dhcp_ethN=1
	ipv4_gw=192.1.3.254
	ipv6_gw=2001:db8:1.3::254
	;;
    rise)
	ipv4_eth0=198.18.1.12/24
	ipv6_eth0=2001:db8:1::12/64
	ipv4_eth1=192.0.2.12/24
	ipv6_eth1=2001:db8:0:2::12/64
	dhcp_ethN=2
	ipv4_gw=192.0.2.254
	ipv6_gw=2001:db8:0:2::254
	;;
    set)
	ipv4_eth0=198.18.1.15/24
	ipv6_eth0=2001:db8:1::15/64
	ipv4_eth1=192.0.1.15/24
	ipv6_eth1=2001:db8:0:1::15/64
	dhcp_ethN=2
	ipv4_gw=192.0.1.254
	ipv6_gw=2001:db8:0:1::254
	;;
    *)
	dhcp_ethN=0
	ipv4_gw=192.19.0.1
	;;
esac

test "${ipv4_eth0}" && debug ipv4_eth0=${ipv4_eth0}
test "${ipv6_eth0}" && debug ipv6_eth0=${ipv6_eth0}
test "${ipv4_eth1}" && debug ipv4_eth1=${ipv4_eth1}
test "${ipv6_eth1}" && debug ipv6_eth1=${ipv6_eth1}
test "${ipv4_eth2}" && debug ipv4_eth2=${ipv4_eth2}
test "${ipv6_eth2}" && debug ipv6_eth2=${ipv6_eth2}
test "${ipv4_gw}"   && debug ipv4_gw=${ipv4_gw}
test "${ipv6_gw}"   && debug ipv6_gw=${ipv6_gw}
test "${dhcp_ethN}" && debug dhcp_ethN=${dhcp_ethN}
