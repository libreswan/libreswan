<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
                   "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">

<refentry>
<refentryinfo>
  <author><firstname>Paul</firstname><surname>Wouters</surname><authorblurb><para>placeholder to suppress warning</para> </authorblurb></author>
</refentryinfo>
<refmeta>
<refentrytitle>IPSEC_SHOWHOSTKEY</refentrytitle>
<manvolnum>8</manvolnum>
<refmiscinfo class='date'>29 April 2012</refmiscinfo>
<refmiscinfo class="source">libreswan</refmiscinfo>
<refmiscinfo class="manual">Executable programs</refmiscinfo>
</refmeta>
<refnamediv id='name'>
<refname>ipsec showhostkey</refname>
<refpurpose>show host's authentication key</refpurpose>
</refnamediv>

<!-- body begins here -->
<refsynopsisdiv id='synopsis'>
  <cmdsynopsis>
    <command>ipsec</command>

    <arg choice='plain'><replaceable>showhostkey</replaceable></arg>
    <arg>--verbose</arg>

    <arg choice='req'>
      <group choice='plain'>
	<arg choice='plain'>--version</arg>
	<arg choice='plain'>--list</arg>
	<arg choice='plain'>--dump</arg>
	<arg choice='plain'>--left</arg>
	<arg choice='plain'>--right</arg>
	<arg choice='plain'>--ipseckey</arg>
      </group>
    </arg>
    <sbr/>

    <arg choice='opt'>
      <group choice='plain'>
	<arg choice='plain'>--ckaid <replaceable>ckaid</replaceable></arg>
	<arg choice='plain'>--rsaid <replaceable>rsaid</replaceable></arg>
      </group>
    </arg>
    <sbr/>

    <arg>--gateway <replaceable>gateway</replaceable></arg>
    <arg>--precedence <replaceable>precedence</replaceable></arg>
    <sbr/>

    <arg>--configdir <replaceable>configdir</replaceable></arg>
    <arg>--password <replaceable>password</replaceable></arg>

  </cmdsynopsis>
</refsynopsisdiv>

<refsect1 id='description'>

  <title>DESCRIPTION</title>

  <para>
    <emphasis remap='I'>Showhostkey</emphasis> outputs (on standard
    output) a public key suitable for this host, in the format
    specified, using the host key information stored in the NSS
    database.
  </para>
  <para>
    In general, since only the super-user can access the NSS database,
    only the super-user can display the public key information.
  </para>

  <refsect2>
    <title>Common Options</title>
    <variablelist>

      <varlistentry>
	<term>
	  <option>--version</option>
	</term>
	<listitem>
	  <para>
	    Print the libreswan version, then exit.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--verbose</option>
	</term>
	<listitem>
	  <para>
	    Increase the verbosity.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--configdir <replaceable>configdir</replaceable></option>
	</term>
	<listitem>
	  <para>
	    Specify the libreswan configuration directory that
	    contains the NSS database (default
	    <filename>@IPSEC_NSSDIR@</filename>).
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--password <replaceable>password</replaceable></option>
	</term>
	<listitem>
	  <para>
	    Specify the password to use when accessing the NSS
	    database (default contained in
	    <filename>@IPSEC_NSSDIR@/nsspassword</filename>).
	  </para>
	</listitem>
      </varlistentry>

    </variablelist>
  </refsect2>

  <refsect2>
    <title>List Options</title>
    <variablelist>

      <varlistentry>
	<term>
	  <option>--list</option>
	</term>
	<listitem>
	  <para>
	    List the private keys.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--dump</option>
	</term>
	<listitem>
	  <para>
	    List, with more details, the private keys.
	  </para>
	</listitem>
      </varlistentry>

    </variablelist>
  </refsect2>

  <refsect2>
    <title>Public Key Options</title>
    <variablelist>

      <varlistentry>
	<term>
	  <option>--ckaid</option> <replaceable>ckaid</replaceable>
	</term>
	<listitem>
	  <para>
	    Select the public key to display using the NSS ckaid.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--rsaid</option> <replaceable>rsaid</replaceable>
	</term>
	<listitem>
	  <para>
	    Select the public key to display using the RSA key ID.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--left</option>
	</term>
	<term>
	  <option>--right</option>
	</term>
	<listitem>
	  <para>
	    Print the selected public key in
	    <citerefentry><refentrytitle>ipsec.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>
	    format, as a <emphasis remap='B'>leftrsasigkey</emphasis>
	    or <emphasis remap='B'>rightrsasigkey</emphasis> parameter
	    respectively.  For example, <option>--left</option> might
	    give (with the key data trimmed down for clarity):
	  </para>
	  <literallayout>
leftrsasigkey=0sAQOF8tZ2...+buFuFn/
	  </literallayout>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--ipseckey</option>
	</term>
	<listitem>
	  <para>
	    Print the selected public key in a format suitable for use
	    as opportunistic-encryption DNS IPSECKEY record format
	    (RFC 4025). A gateway can be specified with the
	    <option>--gateway</option>, which currently supports IPv4
	    and IPv6 addresses. For the host name, the value returned
	    by <emphasis>gethostname</emphasis> is used, with a
	    <emphasis remap='B'>.</emphasis> appended.
	  </para>
	  <para>
	    For example, <option>--ipseckey --gateway
	    10.11.12.13</option> might give (with the key data trimmed
	    for clarity):
	  </para>
	  <literallayout>
IN    IPSECKEY  10 1 2 10.11.12.13  AQOF8tZ2...+buFuFn/"
	  </literallayout>

	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--gateway <replaceable>gateway</replaceable></option>
	</term>
	<listitem>
	  <para>
	    For <option>--ipseckey</option>, specify the
	    <replaceable>gateway</replaceable> to display with the DNS
	    IPSECKEY record.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
	  <option>--precedence <replaceable>precedence</replaceable></option>
	</term>
	<listitem>
	  <para>
	    For <option>--ipseckey</option>, specify the
	    <replaceable>precedence</replaceable> to display with the DNS
	    IPSECKEY record.
	  </para>
	</listitem>
      </varlistentry>

    </variablelist>
  </refsect2>
</refsect1>

<refsect1 id='diagnostics'>
  <title>DIAGNOSTICS</title>
  <para>
    A complaint about &ldquo;no pubkey line found&rdquo; indicates
    that the host has a key but it was generated with an old version
    of FreeS/WAN and does not contain the information that <emphasis
    remap='I'>showhostkey</emphasis> needs.
  </para>
</refsect1>

<refsect1 id='files'>
  <title>FILES</title>
  <para>
    <filename>@IPSEC_NSSDIR@</filename>,
    <filename>@IPSEC_NSSDIR@/nsspassword</filename>
  </para>
</refsect1>

<refsect1 id='see_also'>
  <title>SEE ALSO</title>
  <para>
    <citerefentry><refentrytitle>ipsec.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>,
    <citerefentry><refentrytitle>ipsec rsasigkey</refentrytitle><manvolnum>8</manvolnum></citerefentry>
    <citerefentry><refentrytitle>ipsec newhostkey</refentrytitle><manvolnum>8</manvolnum></citerefentry>
  </para>
</refsect1>

<refsect1 id='history'>
  <title>HISTORY</title>
  <para>
    Written for the Linux FreeS/WAN project &lt;<ulink
    url='http://www.freeswan.org'>http://www.freeswan.org</ulink>&gt;
    by Henry Spencer. Updated by Paul Wouters for the IPSECKEY
    format.
  </para>
</refsect1>

<refsect1 id='bugs'>
  <title>BUGS</title>
  <para>
    Arguably, rather than just reporting the no-IN-KEY-line-found
    problem, <emphasis remap='I'>showhostkey</emphasis> should be
    smart enough to run the existing key through <emphasis
    remap='I'>rsasigkey</emphasis> with the
    <option>--oldkey</option> option, to generate a suitable output
    line.
  </para>
</refsect1>
</refentry>

